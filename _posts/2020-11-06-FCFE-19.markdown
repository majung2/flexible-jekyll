---
layout: post
title: "[íŒ¨ìŠ¤íŠ¸ìº í¼ìŠ¤ ìˆ˜ê°• í›„ê¸°] í”„ë¡ íŠ¸ì—”ë“œ ì¸ê°• 100% í™˜ê¸‰ ì±Œë¦°ì§€ 19íšŒì°¨ ë¯¸ì…˜"
date: 2020-11-06 22:38:26 +0300
description: # Add post description (optional)
img: FCFE/post19.jpg
tags: [íŒ¨ìŠ¤íŠ¸ìº í¼ìŠ¤, FastCampus, Front-End, ì¸ê°•, JavaScript]
---

ê°•ì˜

- [25 - 39 ì±… ì •ë³´ ë³´ê¸°](#39-ì±…-ì •ë³´-ë³´ê¸°)
- [25 - 40 ì±… ì •ë³´ ìˆ˜ì •](#40-ì±…-ì •ë³´-ìˆ˜ì •)

---

# 39 ì±… ì •ë³´ ë³´ê¸°

## íŒŒì¼ ìƒì„±

- `book.html` ìƒì„±
- `book.css` ìƒì„±
- `book.js` ìƒì„±

`book.js` í° í‹€

![25 - 39 ì±… ì •ë³´ ë³´ê¸° - book.js í° í‹€]({{site.baseurl}}/assets/img/FCFE/post19-1.png)

<br>
<br>

## book.js

```
function getToken() {
  return localStorage.getItem("token");
}

async function getUserByToken(token) {
  try {
    const res = await axios.get(`https://api.marktube.tv/v1/me`, {
      headers: {
        Authorization: `Bearer ${token}`,
      },
    });
    return res.data;
  } catch (error) {
    console.log("getUserByToken error", error);
    return null;
  }
}

async function getBook(bookId) {
  const token = getToken();
  if (token === null) {
    location.assign("/login");
    return null;
  }
  try {
    const res = await axios.get(`https://api.marktube.tv/v1/book/${bookId}`, {
      headers: {
        Authorization: `Bearer ${token}`,
      },
    });
    return res.data;
  } catch (error) {
    console.log("getBook error", error);
    return null;
  }
}

async function logout() {
  const token = getToken();
  if (token === null) {
    location.assign("/login");
    return;
  }
  try {
    await axios.delete(`https://api.marktube.tv/v1/me`, {
      headers: {
        Authorization: `Bearer ${token}`,
      },
    });
  } catch (error) {
    console.log("logout error", error);
  } finally {
    localStorage.clear();
    location.assign("/login");
  }
}

async function deleteBook(bookId) {
  const token = getToken();
  if (token === null) {
    location = "/login";
    return;
  }
  await axios.delete(`https://api.marktube.tv/v1/book/${bookId}`, {
    headers: {
      Authorization: `Bearer ${token}`,
    },
  });
}

function bindLogoutButton() {
  const btnLogout = document.querySelector("#btn_logout");
  btnLogout.addEventListener("click", logout);
}

function render(book) {
  const detailElement = document.querySelector("#detail");
  detailElement.innerHTML = `<div class="card bg-light w-100">
    <div class="card-header"><h4>${book.title}</h4></div>
    <div class="card-body">
      <h5 class="card-title">"${book.message}"</h5>
      <p class="card-text">ê¸€ì“´ì´ : ${book.author}</p>
      <p class="card-text">ë§í¬ : <a href="${
        book.url
      }" target="_BLANK">ë°”ë¡œ ê°€ê¸°</a></p>
      <a href="/edit?id=${book.bookId}" class="btn btn-primary btn-sm">Edit</a>
      <button type="button" class="btn btn-danger btn-sm" id="btn-delete">Delete</button>
    </div>
    <div class="card-footer">
        <small class="text-muted">ì‘ì„±ì¼ : ${new Date(
          book.createdAt
        ).toLocaleString()}</small>
      </div>
  </div>`;

  document.querySelector("#btn-delete").addEventListener("click", async () => {
    try {
      await deleteBook(book.bookId);
      location.href = "/";
    } catch (error) {
      console.log(error);
    }
  });
}

async function main() {
  // ë²„íŠ¼ì— ì´ë²¤íŠ¸ ì—°ê²°
  bindLogoutButton();
  // ë¸Œë¼ìš°ì €ì—ì„œ id ê°€ì ¸ì˜¤ê¸°
  const bookId = new URL(location.href).searchParams.get("id");
  // í† í° ì²´í¬
  const token = getToken();
  if (token === null) {
    location.href = "/login";
    return;
  }
  // í† í°ìœ¼ë¡œ ì„œë²„ì—ì„œ ë‚˜ì˜ ì •ë³´ ë°›ì•„ì˜¤ê¸°
  const user = await getUserByToken(token);
  if (user === null) {
    localStorage.clear();
    location.href = "/login";
    return;
  }
  // ì±…ì„ ì„œë²„ì—ì„œ ë°›ì•„ì˜¤ê¸°
  const book = await getBook(bookId);
  if (book === null) {
    alert("ì„œë²„ì—ì„œ ì±… ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨");
    return;
  }

  console.log(book);
  // ë°›ì•„ì˜¨ ì±…ì„ ê·¸ë¦¬ê¸°
  render(book);
}

document.addEventListener("DOMContentLoaded", main);
```

<br>
<br>
<br>
<br>
<br>

# 40 ì±… ì •ë³´ ìˆ˜ì •

## íŒŒì¼ìƒì„±

- `edit.html` , `edit.css`, `edit.js` ìƒì„±í•˜ê¸°

### edit.js í° í‹€

```
async function main() {
  // ë¸Œë¼ìš°ì € id ê°€ì ¸ì˜¤ê¸°
  // í† í°ì²´í¬
  // í† í°ìœ¼ë¡œ ì„œë²„ì—ì„œ ë‚˜ì˜ ì •ë³´ ë°›ì•„ì˜¤ê¸°
  // ì±…ì„ ì„œë²„ì—ì„œ ë°›ì•„ì˜¤ê¸°
  // ë°›ì•„ì˜¨ ì±…ì„ ê·¸ë¦¬ê¸°
}

document.addEventListener("DOMContentLoaded", main);
```

<br>
<br>

## book.js

```
function render(book) {
  const titleElement = document.querySelector("#title");
  titleElement.value = book.title;

  const messageElement = document.querySelector("#message");
  messageElement.value = book.message;

  const authorElement = document.querySelector("#author");
  authorElement.value = book.author;

  const urlElement = document.querySelector("#url");
  urlElement.value = book.url;

  const form = document.querySelector("#form-edit-book");
  form.addEventListener("submit", async (event) => {
    event.preventDefault();
    event.stopPropagation();
    event.target.classList.add("was-validated");

    try {
      await updateBook(book.bookId);
      location.assign(`book?id=${book.bookId}`);
    } catch (error) {
      console.log(error);
    }
  });
}

async function updateBook(bookId) {
  const titleElement = document.querySelector("#title");
  const messageElement = document.querySelector("#message");
  const authorElement = document.querySelector("#author");
  const urlElement = document.querySelector("#url");

  const title = titleElement.value;
  const message = messageElement.value;
  const author = authorElement.value;
  const url = urlElement.value;

  if (title === "" || message === "" || author === "" || url === "") {
    return;
  }

  const token = getToken();
  if (token === null) {
    location.assign("/login");
    return;
  }

  await axios.patch(
    `https://api.marktube.tv/v1/book/${bookId}`,
    {
      title,
      message,
      author,
      url,
    },
    {
      headers: {
        Authorization: `Bearer ${token}`,
      },
    }
  );

  const cancelButtonElement = document.querySelector("#btn-cancel");
  cancelButtonElement.addEventListener("click", (event) => {
    event.preventDefault();
    event.stopPropagation();
    location.assign(`book?id=${book.bookId}`);
  });
}

async function getUserByToken(token) {
  try {
    const res = await axios.get("https://api.marktube.tv/v1/me", {
      headers: {
        Authorization: `Bearer ${token}`,
      },
    });
    return res.data;
  } catch (error) {
    console.log("getUserByToken error", error);
    return null;
  }
}

function getToken() {
  return localStorage.getItem("token");
}

async function getBook(bookId) {
  const token = getToken();
  if (token === null) {
    location.href = "/login";
    return null;
  }
  try {
    const res = await axios.get(`https://api.marktube.tv/v1/book/${bookId}`, {
      headers: {
        Authorization: `Bearer ${token}`,
      },
    });
    return res.data;
  } catch (error) {
    console.log("getBook error", error);
    return null;
  }
}

async function main() {
  // ë¸Œë¼ìš°ì € id ê°€ì ¸ì˜¤ê¸°
  const bookId = new URL(location.href).searchParams.get("id");
  // í† í°ì²´í¬
  const token = getToken();
  if (token === null) {
    location.href = "/login";
    return;
  }
  // í† í°ìœ¼ë¡œ ì„œë²„ì—ì„œ ë‚˜ì˜ ì •ë³´ ë°›ì•„ì˜¤ê¸°
  const user = await getUserByToken(token);
  if (user === null) {
    localStorage.clear();
    location = "/login";
    return;
  }
  // ì±…ì„ ì„œë²„ì—ì„œ ë°›ì•„ì˜¤ê¸°
  const book = await getBook(bookId);
  if (book === null) {
    alert("ì„œë²„ì—ì„œ ì±… ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨");
    return;
  }
  console.log(book);
  // ë°›ì•„ì˜¨ ì±…ì„ ê·¸ë¦¬ê¸°
  render(book);
}

document.addEventListener("DOMContentLoaded", main);
```

![25 - 40 ì±… ì •ë³´ ìˆ˜ì •]({{site.baseurl}}/assets/img/FCFE/post19-2.png)

---

<br>

#### 19íšŒì°¨ ì¸ì¦ìƒ·

![19íšŒì°¨ ì¸ì¦ìƒ·]({{site.baseurl}}/assets/img/FCFE/post19.jpg)
<br>  
<br>

ì˜¬ì¸ì› íŒ¨í‚¤ì§€ : í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œğŸ‘‰[https://bit.ly/3m0t8GM](https://bit.ly/3m0t8GM)
